<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北京时间显示</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }
        .date, .time, .weekday {
            text-align: center;
        }
        .date { font-size: 8vw; margin-bottom: 1rem; }
        .time { font-size: 15vw; font-weight: bold; }
        .weekday { font-size: 9vw; margin-top: 0.5rem; }
        .error { font-size: 2vw; color: #ff4444; text-align: center; }
        .controls {
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .button {
            margin: 0.5rem;
            padding: 1rem 2rem;
            font-size: 1.5rem;
            color: #D3D3D3; /* 更淡的灰色 */
            background-color: transparent;
            border: 2px solid #D3D3D3; /* 更淡的灰色 */
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .button:hover {
            background-color: rgba(211, 211, 211, 0.3);
            color: #ffffff; /* 悬浮时文字颜色变白 */
        }
        .label {
            font-size: 0.75rem;
            color: #ffffff;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .sync-time {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            color: #B0B0B0; /* 更淡的灰色 */
            white-space: nowrap;
            overflow: hidden;
            width: 250px; /* 增加宽度 */
        }
        .fullscreen-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 1rem;
            background-color: #000000; /* 黑色背景 */
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1.5rem;
            transition: background-color 0.3s ease;
            z-index: 20;
        }
        .fullscreen-btn:hover {
            background-color: #333333; /* 悬浮时变成深灰色 */
        }
        .exit-fullscreen-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2rem;
            color: #D3D3D3; /* 更淡的灰色 */
            cursor: pointer;
            display: none; /* 默认不显示 */
            z-index: 20;
        }
        .exit-fullscreen-btn:hover {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="date" id="date"></div>
    <div class="time" id="time">错误</div>
    <div class="weekday" id="weekday"></div>
    <div class="error" id="error"></div>

    <div class="controls" id="controls">
        <div class="control-group">
            <span class="label">时间</span>
            <button class="button" id="increaseTimeFont">+</button>
            <span class="label" id="timeLabel">字体大小: 300px</span>
            <button class="button" id="decreaseTimeFont">-</button>
        </div>
        <div class="control-group">
            <span class="label">日期</span>
            <button class="button" id="increaseDateFont">+</button>
            <span class="label" id="dateLabel">字体大小: 145px</span>
            <button class="button" id="decreaseDateFont">-</button>
        </div>
        <div class="control-group">
            <span class="label">星期</span>
            <button class="button" id="increaseWeekdayFont">+</button>
            <span class="label" id="weekdayLabel">字体大小: 170px</span>
            <button class="button" id="decreaseWeekdayFont">-</button>
        </div>
    </div>

    <!-- 校正时间显示 -->
    <div id="syncTime" class="sync-time"></div>

    <!-- 全屏按钮 -->
    <button id="toggleFullScreen" class="fullscreen-btn">全屏</button>

    <!-- 退出全屏按钮 -->
    <span id="exitFullScreen" class="exit-fullscreen-btn">X</span>

    <script>
        let serviceAvailable = false;
        const maxRetries = 3; // 最大重试次数
        let syncCount = 0; // 校正次数计数器
        let isFullScreen = false;

        // 更新按钮颜色与右上角文字一致
        function updateButtonColor() {
            const buttons = document.querySelectorAll('.button');
            buttons.forEach(button => {
                button.style.color = "#B0B0B0"; // 更淡的灰色
                button.style.borderColor = "#B0B0B0"; // 更淡的灰色
            });
        }

        // 同步时间函数
        async function syncTime(retryCount = 0) {
            try {
                // 请求API获取北京时间
                const response = await fetch('https://timeapi.io/api/Time/current/zone?timeZone=Asia/Shanghai');
                if (!response.ok) throw new Error('API响应失败');
                const data = await response.json();

                serviceAvailable = true;
                updateSyncTime(); // 更新校正时间
                updateTime(data.dateTime); // 更新显示的时间
            } catch (error) {
                console.error('同步时间失败：', error);
                serviceAvailable = false;
                if (retryCount < maxRetries) {
                    console.log(`重试第 ${retryCount + 1} 次...`);
                    syncTime(retryCount + 1); // 递归调用实现重试
                } else {
                    displayError('时间服务不可用，请检查网络连接');
                }
            }
        }

        // 更新校正时间显示
        function updateSyncTime() {
            syncCount++; // 增加校正次数
            const syncTimeElement = document.getElementById('syncTime');
            syncTimeElement.textContent = `校正次数: ${syncCount}`;
            updateButtonColor(); // 更新按钮颜色
        }

        // 更新显示时间、日期和星期
        function updateTime(dateTime) {
            const now = new Date(dateTime); // 使用从API获取到的时间
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            const dateStr = `${now.getFullYear()}年${String(now.getMonth() + 1).padStart(2, '0')}月${String(now.getDate()).padStart(2, '0')}日`;
            const weekdayStr = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"][now.getDay()];

            document.getElementById('time').textContent = timeStr;
            document.getElementById('date').textContent = dateStr;
            document.getElementById('weekday').textContent = weekdayStr;
        }

        // 每秒请求一次API
        setInterval(() => {
            syncTime(); // 每秒请求一次
        }, 1000);

        // 时间字体大小调节
        let timeFontSize = 300; // 初始时间字体大小
        document.getElementById('increaseTimeFont').addEventListener('click', () => {
            timeFontSize += 20;
            document.getElementById('time').style.fontSize = `${timeFontSize}px`;
            document.getElementById('timeLabel').textContent = `字体大小: ${timeFontSize}px`;
        });

        document.getElementById('decreaseTimeFont').addEventListener('click', () => {
            if (timeFontSize > 50) {
                timeFontSize -= 20;
                document.getElementById('time').style.fontSize = `${timeFontSize}px`;
                document.getElementById('timeLabel').textContent = `字体大小: ${timeFontSize}px`;
            }
        });

        // 日期字体大小调节
        let dateFontSize = 145; // 初始日期字体大小
        document.getElementById('increaseDateFont').addEventListener('click', () => {
            dateFontSize += 20;
            document.getElementById('date').style.fontSize = `${dateFontSize}px`;
            document.getElementById('dateLabel').textContent = `字体大小: ${dateFontSize}px`;
        });

        document.getElementById('decreaseDateFont').addEventListener('click', () => {
            if (dateFontSize > 50) {
                dateFontSize -= 20;
                document.getElementById('date').style.fontSize = `${dateFontSize}px`;
                document.getElementById('dateLabel').textContent = `字体大小: ${dateFontSize}px`;
            }
        });

        // 星期字体大小调节
        let weekdayFontSize = 170; // 初始星期字体大小
        document.getElementById('increaseWeekdayFont').addEventListener('click', () => {
            weekdayFontSize += 20;
            document.getElementById('weekday').style.fontSize = `${weekdayFontSize}px`;
            document.getElementById('weekdayLabel').textContent = `字体大小: ${weekdayFontSize}px`;
        });

        document.getElementById('decreaseWeekdayFont').addEventListener('click', () => {
            if (weekdayFontSize > 50) {
                weekdayFontSize -= 20;
                document.getElementById('weekday').style.fontSize = `${weekdayFontSize}px`;
                document.getElementById('weekdayLabel').textContent = `字体大小: ${weekdayFontSize}px`;
            }
        });

        // 全屏/退出全屏功能
        document.getElementById('toggleFullScreen').addEventListener('click', () => {
            if (!isFullScreen) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                isFullScreen = true;
                document.getElementById('toggleFullScreen').style.display = "none";
                document.getElementById('controls').style.display = "none"; // 隐藏所有控制按钮
                document.getElementById('exitFullScreen').style.display = "block"; // 显示退出全屏按钮
            }
        });

        // 退出全屏按钮
        document.getElementById('exitFullScreen').addEventListener('click', () => {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
            isFullScreen = false;
            document.getElementById('toggleFullScreen').style.display = "block"; // 恢复全屏按钮
            document.getElementById('controls').style.display = "block"; // 恢复控制按钮
            document.getElementById('exitFullScreen').style.display = "none"; // 隐藏退出全屏按钮
        });

        // 初始化页面时，先同步一次时间
        syncTime();
    </script>
</body>
</html>
